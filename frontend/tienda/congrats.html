<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gracias por tu compra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-[#0F172A] text-white flex items-center justify-center min-h-screen p-6">

  <div class="max-w-lg w-full bg-[#1E293B] p-8 rounded-2xl text-center shadow-xl">
    <!-- Estado cargando -->
    <div id="loading" class="animate-pulse">
      <div class="w-12 h-12 mx-auto mb-4 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
      <p>Verificando tu pago...</p>
    </div>

    <!-- Éxito -->
    <div id="success" class="hidden">
      <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-green-600 rounded-full">
        ✅
      </div>
      <h1 class="text-2xl font-semibold mb-2">¡Gracias por tu compra!</h1>
      <p class="text-gray-300">Tu pago se procesó correctamente.</p>
      <p id="order-id" class="text-sm text-gray-500 mt-2"></p>
      <a href="/" class="inline-block mt-6 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-white font-medium">
        Volver a la tienda
      </a>
    </div>

    <!-- Procesando -->
    <div id="processing" class="hidden">
      <div class="w-16 h-16 mx-auto mb-4 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin"></div>
      <h1 class="text-xl font-semibold mb-2 text-yellow-400">Tu pago está en proceso</h1>
      <p class="text-gray-300">Te notificaremos una vez se confirme.</p>
    </div>

    <!-- Error -->
    <div id="error" class="hidden">
      <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-red-600 rounded-full text-2xl">
        ❌
      </div>
      <h1 class="text-2xl font-semibold mb-2">Hubo un problema con tu pago</h1>
      <p id="error-message" class="text-gray-300"></p>
      <a href="/" class="inline-block mt-6 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg text-white font-medium">
        Volver al inicio
      </a>
    </div>
  </div>

  <script>
    const stripe = Stripe('pk_test_51SJ0SkQgvgdQqQVEfityZf2aMvcdyEZaqWfrUl0AW8XCJKuZhRxnidAl31RMNumHjsDRS1dznNk3xnIhhnWdfVS000ZqN8BajB');

    const loadingEl = document.getElementById('loading');
    const successEl = document.getElementById('success');
    const errorEl = document.getElementById('error');
    const processingEl = document.getElementById('processing');
    const errorMessageEl = document.getElementById('error-message');
    const orderIdEl = document.getElementById('order-id');

    async function checkPayment() {
      const urlParams = new URLSearchParams(window.location.search);
      const clientSecret = urlParams.get('payment_intent_client_secret');

      if (!clientSecret) {
        showError('No se encontró información del pago. Por favor, contactá a soporte.');
        return;
      }

      try {
        const { paymentIntent, error } = await stripe.retrievePaymentIntent(clientSecret);

        loadingEl.classList.add('hidden');

        if (error) {
          showError(error.message);
          return;
        }

        switch (paymentIntent.status) {
          case 'succeeded':
            successEl.classList.remove('hidden');
            orderIdEl.textContent = `ID de transacción: ${paymentIntent.id}`;
            break;
          case 'processing':
            processingEl.classList.remove('hidden');
            break;
          case 'requires_payment_method':
            showError('El pago no se pudo completar. Por favor, intentá nuevamente.');
            break;
          default:
            showError('Ocurrió un estado inesperado en el pago.');
        }
      } catch (err) {
        showError('Error al verificar el pago. Intenta nuevamente.');
        console.error(err);
      }
    }

    function showError(message) {
      loadingEl.classList.add('hidden');
      errorEl.classList.remove('hidden');
      errorMessageEl.textContent = message;
    }

    checkPayment();
  </script>

</body>
</html>
